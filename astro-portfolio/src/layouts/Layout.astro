---
// Layout.astro - Declarative base layout with GSAP

interface Props {
  title: string;
  description?: string;
}

const { title, description = "Full-stack developer building web applications" } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <title>{title}</title>
  </head>
  <body style="min-height: 100vh; margin: 0; padding: 0; color: #c8ced8; font-family: system-ui, -apple-system, sans-serif; overflow-x: hidden;">
    <!-- Background -->
    <div id="bg-gradient" style="position: fixed; inset: 0; background: linear-gradient(to bottom right, #0a0a0a 0%, #0a0a0a 60%, #0a1628 85%, #1e3a5f 100%); z-index: -20;"></div>
    
    <!-- Animated glows -->
    <div id="glow-1" style="position: fixed; top: -200px; left: 10%; width: 600px; height: 500px; background: radial-gradient(ellipse, rgba(99, 102, 241, 0.3) 0%, transparent 70%); filter: blur(80px); z-index: -15; pointer-events: none;"></div>
    <div id="glow-2" style="position: fixed; bottom: -100px; right: 5%; width: 500px; height: 400px; background: radial-gradient(ellipse, rgba(56, 189, 248, 0.2) 0%, transparent 70%); filter: blur(100px); z-index: -15; pointer-events: none;"></div>
    <div id="glow-3" style="position: fixed; top: 40%; left: 60%; width: 400px; height: 300px; background: radial-gradient(ellipse, rgba(168, 85, 247, 0.15) 0%, transparent 70%); filter: blur(60px); z-index: -15; pointer-events: none;"></div>
    
    <!-- Particles canvas -->
    <canvas id="particles" style="position: fixed; inset: 0; z-index: -10; pointer-events: none;"></canvas>
    
    <!-- Cursor glow -->
    <div id="cursor-glow" style="position: fixed; width: 300px; height: 300px; border-radius: 50%; background: radial-gradient(circle, rgba(255, 159, 92, 0.15) 0%, transparent 70%); filter: blur(40px); z-index: 9999; pointer-events: none; opacity: 0;"></div>
    
    <!-- Main content -->
    <div class="relative">
      <slot />
    </div>
    
    <!-- GSAP + Particles -->
    <script>
      import gsap from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";
      
      gsap.registerPlugin(ScrollTrigger);
      
      // Background glows use CSS keyframes (see global.css) for better Firefox support
      
      // Cursor glow follower
      const cursorGlow = document.getElementById("cursor-glow");
      let mouseX = 0, mouseY = 0, glowX = 0, glowY = 0;
      
      document.addEventListener("mousemove", (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        if (cursorGlow) cursorGlow.style.opacity = "1";
      });
      
      document.addEventListener("mouseleave", () => {
        if (cursorGlow) cursorGlow.style.opacity = "0";
      });
      
      function animateCursor() {
        glowX += (mouseX - glowX - 150) * 0.08;
        glowY += (mouseY - glowY - 150) * 0.08;
        if (cursorGlow) {
          cursorGlow.style.transform = `translate(${glowX}px, ${glowY}px)`;
        }
        requestAnimationFrame(animateCursor);
      }
      animateCursor();
      
      // Particles
      const canvas = document.getElementById("particles") as HTMLCanvasElement;
      const ctx = canvas?.getContext("2d");
      let particles: Array<{x: number; y: number; vx: number; vy: number; size: number; alpha: number}> = [];
      
      function resizeCanvas() {
        if (canvas) {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
      }
      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);
      
      function createParticle() {
        return {
          x: Math.random() * (canvas?.width || 0),
          y: Math.random() * (canvas?.height || 0),
          vx: (Math.random() - 0.5) * 0.3,
          vy: (Math.random() - 0.5) * 0.3,
          size: Math.random() * 2 + 0.5,
          alpha: Math.random() * 0.5 + 0.1
        };
      }
      
      for (let i = 0; i < 50; i++) particles.push(createParticle());
      
      function animateParticles() {
        if (!ctx || !canvas) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          
          if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
          if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
          
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(255, 255, 255, ${p.alpha})`;
          ctx.fill();
        });
        
        requestAnimationFrame(animateParticles);
      }
      animateParticles();
      
      // Element animations
      const animationConfig = {
        "fade-up": { y: 40, opacity: 0, duration: 0.8, ease: "power3.out" },
        "fade-in": { scale: 0.95, opacity: 0, duration: 0.6, ease: "power2.out" },
        "slide-right": { x: -40, opacity: 0, duration: 0.8, ease: "power3.out" },
      };
      
      function isInViewport(el: Element): boolean {
        const rect = el.getBoundingClientRect();
        return rect.top < window.innerHeight && rect.bottom > 0;
      }
      
      document.querySelectorAll("[data-animate]").forEach((el, index) => {
        const type = el.getAttribute("data-animate") as keyof typeof animationConfig;
        const delay = parseFloat(el.getAttribute("data-delay") || "0");
        const config = animationConfig[type] || animationConfig["fade-up"];
        
        if (isInViewport(el)) {
          gsap.from(el, { ...config, delay });
        } else {
          gsap.from(el, {
            ...config,
            delay: delay + index * 0.05,
            scrollTrigger: { trigger: el, start: "top 85%", once: true },
          });
        }
      });
      
      document.querySelectorAll("[data-stagger]").forEach((container) => {
        const items = container.querySelectorAll("[data-stagger-item]");
        gsap.from(items, {
          y: 60,
          opacity: 0,
          duration: 0.8,
          stagger: 0.1,
          ease: "power3.out",
          scrollTrigger: { trigger: container, start: "top 80%", once: true },
        });
      });
    </script>
  </body>
</html>

<style is:global>
  @import "../styles/global.css";
</style>
